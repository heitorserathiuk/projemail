#include "Gsender.h"
Gsender* Gsender::_instance = 0;
Gsender::Gsender(){}
Gsender* Gsender::Instance()
{
    if (_instance == 0) 
        _instance = new Gsender;
    return _instance;
}

Gsender* Gsender::Subject(const char* subject)
{
  delete [] _subject;
  _subject = new char[strlen(subject)+1];
  strcpy(_subject, subject);
  return _instance;
}
Gsender* Gsender::Subject(const String &subject)
{
  return Subject(subject.c_str());
}

bool Gsender::AwaitSMTPResponse(WiFiClientSecure &client, const String &resp, uint16_t timeOut)
{
  uint32_t ts = millis();
  while (!client.available())
  {
    if(millis() > (ts + timeOut)) {
      _error = "SMTP Response TIMEOUT!";
      return false;
    }
  }
  _serverResponce = client.readStringUntil('\n');
#if defined(GS_SERIAL_LOG_1) || defined(GS_SERIAL_LOG_2) 
  Serial.println(_serverResponce);
#endif
  if (resp && _serverResponce.indexOf(resp) == -1) return false;
  return true;
}

String Gsender::getLastResponce()
{
  return _serverResponce;
}

const char* Gsender::getError()
{
  return _error;
}

bool Gsender::Send(const String &to, const String &message)
{
  WiFiClientSecure client;
  client.setInsecure();
#if defined(GS_SERIAL_LOG_2)
  Serial.print("Connecting to :");
  Serial.println(SMTP_SERVER);  
#endif
  if(!client.connect(SMTP_SERVER, SMTP_PORT)) {
    _error = "Could not connect to mail server";
    return false;
  }
  if(!AwaitSMTPResponse(client, "220")) {
    _error = "Connection Error";
    return false;
  }

#if defined(GS_SERIAL_LOG_2)
  Serial.println("HELO friend:");
#endif
  client.println("HELO friend");
  if(!AwaitSMTPResponse(client, "250")){
    _error = "identification error";
    return false;
  }

#if defined(GS_SERIAL_LOG_2)
  Serial.println("AUTH LOGIN:");
#endif
  client.println("AUTH LOGIN");
  AwaitSMTPResponse(client);

#if defined(GS_SERIAL_LOG_2)
  Serial.println("EMAILBASE64_LOGIN:");
#endif
  client.println(EMAILBASE64_LOGIN);
  AwaitSMTPResponse(client);

#if defined(GS_SERIAL_LOG_2)
  Serial.println("EMAILBASE64_PASSWORD:");
#endif
  client.println(EMAILBASE64_PASSWORD);
  if (!AwaitSMTPResponse(client, "235")) {
    _error = "SMTP AUTH error";
    return false;
  }  
  String mailFrom = "MAIL FROM: <" + String(FROM) + '>';
#if defined(GS_SERIAL_LOG_2)
  Serial.println(mailFrom);
#endif
  client.println(mailFrom);
  AwaitSMTPResponse(client);
  String rcpt = "RCPT TO: <" + to + '>';
#if defined(GS_SERIAL_LOG_2)
  Serial.println(rcpt);
#endif
  client.println(rcpt);
  AwaitSMTPResponse(client);

#if defined(GS_SERIAL_LOG_2)
  Serial.println("DATA:");
#endif
  client.println("DATA");
  if(!AwaitSMTPResponse(client, "354")) {
    _error = "SMTP DATA error";
    return false;
  }  
  client.println("From: <" + String(FROM) + '>');
  client.println("To: <" + to + '>');  
  client.print("Subject: ");
  client.println(_subject);  
  client.println("Mime-Version: 1.0");
  client.println("Content-Type: text/html; charset=\"UTF-8\"");
  client.println("Content-Transfer-Encoding: 7bit");
  client.println();
  
  String body = "";
  if(message.substring(0,5)=="Tipo1"){
  String  body ="<!DOCTYPE html><html lang='en'><table class='templateContainer' style='background-color: #14539a;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;max-width: 600px !important;' width='100%' cellspacing='0' cellpadding='0' border='0' align='center'><tbody><tr><td class='headerContainer' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'><tr><td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #1AE9E4;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 12px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 50px'><span style='font-size:36px'><strong><span style='font-family:source sans pro,helvetica neue,helvetica,arial,sans-serif'>Prezado Dr.(a),</span></strong></span></div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 16px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center;'>Obrigado por se inscrever na nossa Newsletter.<br>Sua participação é muito importante para nós!</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnImageBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnImageBlockOuter'> <tr> <td style='padding: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnImageBlockInner' valign='top'> <table class='mcnImageContentContainer' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnImageContent' style='padding-right: 9px;padding-left: 9px;padding-top: 0;padding-bottom: 0;text-align: center;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> <img alt='' src='https://mcusercontent.com/ded361822c27b66e8ed0cf72d/images/83ba512e-3b23-4b72-bd44-0b3a2370a494.png' style='max-width: 1055px;padding-bottom: 0;display: inline !important;vertical-align: bottom;border: 0;height: auto;outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;' class='mcnImage' width='564' align='middle'> </td></tr></tbody></table></td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-size: 14px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;font-family: Helvetica;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 40px; margin-bottom: 40px'>Valor LDR : "+message.substring(5)+"</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody></table><table class='mcnCodeBlock' style='border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr><td class='mcnTextBlockInner' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> </td></tr></tbody></table></td></tr></tbody></table></html>";
  }
  if(message.substring(0,5)=="Tipo2"){
  body ="<!DOCTYPE html><html lang='en'><table class='templateContainer' style='background-color: #14539a;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;max-width: 600px !important;' width='100%' cellspacing='0' cellpadding='0' border='0' align='center'><tbody><tr><td class='headerContainer' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'><tr><td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #1AE9E4;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 12px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 50px'><span style='font-size:36px'><strong><span style='font-family:source sans pro,helvetica neue,helvetica,arial,sans-serif'>Prezado Dr.(a),</span></strong></span></div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 16px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center;'>Obrigado por se inscrever na nossa Newsletter.<br>Sua participação é muito importante para nós!</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnImageBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnImageBlockOuter'> <tr> <td style='padding: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnImageBlockInner' valign='top'> <table class='mcnImageContentContainer' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnImageContent' style='padding-right: 9px;padding-left: 9px;padding-top: 0;padding-bottom: 0;text-align: center;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> <img alt='' src='https://i.pinimg.com/originals/d7/5a/e1/d75ae1ae332cb9f6e2d1fadf5b90e115.jpg' style='max-width: 1055px;padding-bottom: 0;display: inline !important;vertical-align: bottom;border: 0;height: auto;outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;' class='mcnImage' width='564' align='middle'> </td></tr></tbody></table></td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-size: 14px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;font-family: Helvetica;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 40px; margin-bottom: 40px'>Valor LDR : "+message.substring(5)+"</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody></table><table class='mcnCodeBlock' style='border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr><td class='mcnTextBlockInner' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> </td></tr></tbody></table></td></tr></tbody></table></html>";
  }
  if(message.substring(0,5)=="Tipo3"){
    body ="<!DOCTYPE html><html lang='en'><table class='templateContainer' style='background-color: #14539a;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;max-width: 600px !important;' width='100%' cellspacing='0' cellpadding='0' border='0' align='center'><tbody><tr><td class='headerContainer' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'><tr><td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #1AE9E4;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 12px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 50px'><span style='font-size:36px'><strong><span style='font-family:source sans pro,helvetica neue,helvetica,arial,sans-serif'>Prezado Dr.(a),</span></strong></span></div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 16px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center;'>Obrigado por se inscrever na nossa Newsletter.<br>Sua participação é muito importante para nós!</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnImageBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnImageBlockOuter'> <tr> <td style='padding: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnImageBlockInner' valign='top'> <table class='mcnImageContentContainer' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnImageContent' style='padding-right: 9px;padding-left: 9px;padding-top: 0;padding-bottom: 0;text-align: center;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> <img alt='' src='https://i.pinimg.com/originals/be/b0/fe/beb0fef7afade9410e7e1cfa383a70b2.gif' style='max-width: 1055px;padding-bottom: 0;display: inline !important;vertical-align: bottom;border: 0;height: auto;outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;' class='mcnImage' width='564' align='middle'> </td></tr></tbody></table></td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-size: 14px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;font-family: Helvetica;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 40px; margin-bottom: 40px'>Valor LDR : "+message.substring(5)+"</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody></table><table class='mcnCodeBlock' style='border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr><td class='mcnTextBlockInner' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> </td></tr></tbody></table></td></tr></tbody></table></html>";
  }
  if(message.substring(0,5)=="Tipo4"){
    body ="<!DOCTYPE html><html lang='en'><table class='templateContainer' style='background-color: #14539a;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;max-width: 600px !important;' width='100%' cellspacing='0' cellpadding='0' border='0' align='center'><tbody><tr><td class='headerContainer' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'><tr><td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #1AE9E4;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 12px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 50px'><span style='font-size:36px'><strong><span style='font-family:source sans pro,helvetica neue,helvetica,arial,sans-serif'>Prezado Dr.(a),</span></strong></span></div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 16px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center;'>Obrigado por se inscrever na nossa Newsletter.<br>Sua participação é muito importante para nós!</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnImageBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnImageBlockOuter'> <tr> <td style='padding: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnImageBlockInner' valign='top'> <table class='mcnImageContentContainer' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnImageContent' style='padding-right: 9px;padding-left: 9px;padding-top: 0;padding-bottom: 0;text-align: center;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> <img alt='' src='https://i.pinimg.com/originals/1f/49/e5/1f49e5745f1c188ecca4fdd83e24f3a4.jpg' style='max-width: 1055px;padding-bottom: 0;display: inline !important;vertical-align: bottom;border: 0;height: auto;outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;' class='mcnImage' width='564' align='middle'> </td></tr></tbody></table></td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-size: 14px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;font-family: Helvetica;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 40px; margin-bottom: 40px'>Valor LDR : "+message.substring(5)+"</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody></table><table class='mcnCodeBlock' style='border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr><td class='mcnTextBlockInner' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> </td></tr></tbody></table></td></tr></tbody></table></html>";
  }
  if(message.substring(0,5)=="Tipo5"){
    body ="<!DOCTYPE html><html lang='en'><table class='templateContainer' style='background-color: #14539a;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;max-width: 600px !important;' width='100%' cellspacing='0' cellpadding='0' border='0' align='center'><tbody><tr><td class='headerContainer' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'><tr><td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #1AE9E4;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 12px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 50px'><span style='font-size:36px'><strong><span style='font-family:source sans pro,helvetica neue,helvetica,arial,sans-serif'>Prezado Dr.(a),</span></strong></span></div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-family: &quot;Source Sans Pro&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 16px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center;'>Obrigado por se inscrever na nossa Newsletter.<br>Sua participação é muito importante para nós!</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody> </table><table class='mcnImageBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnImageBlockOuter'> <tr> <td style='padding: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnImageBlockInner' valign='top'> <table class='mcnImageContentContainer' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnImageContent' style='padding-right: 9px;padding-left: 9px;padding-top: 0;padding-bottom: 0;text-align: center;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> <img alt='' src='https://i.pinimg.com/originals/fc/fa/28/fcfa289cf10ec19ad54e5b24a3be22d5.jpg' style='max-width: 1055px;padding-bottom: 0;display: inline !important;vertical-align: bottom;border: 0;height: auto;outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;' class='mcnImage' width='564' align='middle'> </td></tr></tbody></table></td></tr></tbody> </table><table class='mcnTextBlock' style='min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr> <td class='mcnTextBlockInner' style='padding-top: 9px;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'><!--[if mso]> <table align='left' border='0' cellspacing='0' cellpadding='0' width='100%' style='width:100%;'> <tr><![endif]--><!--[if mso]> <td valign='top' width='600' style='width:600px;'><![endif]--> <table style='max-width: 100%;min-width: 100%;border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' class='mcnTextContentContainer' width='100%' cellspacing='0' cellpadding='0' border='0' align='left'> <tbody><tr> <td class='mcnTextContent' style='padding: 0px 18px 9px;color: #FFFFFF;font-size: 14px;font-style: normal;font-weight: bold;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;font-family: Helvetica;line-height: 150%;text-align: left;' valign='top'> <div style='text-align: center; margin-top: 40px; margin-bottom: 40px'>Valor LDR : "+message.substring(5)+"</div></td></tr></tbody></table><!--[if mso]> </td><![endif]--><!--[if mso]> </tr></table><![endif]--> </td></tr></tbody></table><table class='mcnCodeBlock' style='border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' width='100%' cellspacing='0' cellpadding='0' border='0'> <tbody class='mcnTextBlockOuter'> <tr><td class='mcnTextBlockInner' style='mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;' valign='top'> </td></tr></tbody></table></td></tr></tbody></table></html>";
  }
  if(body==""){
    body ="<!DOCTYPE html><html lang='en'>Formato Inválido.</html>";
  }    
	client.println(body);
  client.println(".");
  if (!AwaitSMTPResponse(client, "250")) {
    _error = "Sending message error";
    return false;
  }
  client.println("QUIT");
  if (!AwaitSMTPResponse(client, "221")) {
    _error = "SMTP QUIT error";
    return false;
  }
  return true;
}